# 头像上传功能指南

## 🎨 新增功能

团队成员头像现在支持：
- **文件上传**: 在管理后台直接上传图片文件
- **URL输入**: 仍然支持使用图片URL
- **随机头像**: 为现有成员自动分配随机头像
- **本地存储**: 上传的图片保存在服务器本地

## 📸 头像上传功能

### 管理后台操作

1. **上传新头像**:
   - 点击"添加成员"或"编辑成员"
   - 在头像区域点击"选择头像"
   - 选择图片文件（支持JPG、PNG等格式）
   - 点击保存

2. **头像要求**:
   - 文件大小：最大 5MB
   - 文件类型：仅支持图片格式
   - 推荐尺寸：正方形图片（200x200像素）

3. **删除头像**:
   - 编辑成员时点击"删除头像"按钮
   - 可以重新上传或使用URL

### 前端显示

- **本地上传**: 优先显示上传的本地图片
- **外部URL**: 回退到图片URL
- **占位符**: 没有头像时显示默认占位符

## 🔧 技术实现

### 后端更改

1. **数据库结构**:
   ```sql
   ALTER TABLE Members ADD COLUMN photo_filename TEXT;
   ```

2. **新增API**:
   - `POST /api/upload/avatar` - 上传头像
   - `GET /api/upload/avatar/:filename` - 获取头像
   - `DELETE /api/upload/avatar/:filename` - 删除头像

3. **文件存储**:
   - 位置：`/uploads/` 目录
   - 命名：唯一文件名防止冲突

### 前端更改

1. **管理界面**:
   - 文件选择器
   - 实时预览
   - 上传进度显示

2. **显示逻辑**:
   - 优先级：本地文件 > URL > 默认占位符
   - 错误处理：图片加载失败时的降级显示

## 🚀 使用步骤

### 首次设置

1. **运行数据库迁移**:
   ```bash
   node server/database/migrate.js
   ```

2. **为现有成员添加头像**:
   ```bash
   node server/scripts/add-random-avatars.js
   ```

3. **重启服务器**:
   ```bash
   npm run dev
   ```

### 管理员操作

1. **登录管理后台**:
   http://localhost:3001/secret-login

2. **添加/编辑成员**:
   - 点击"添加成员"或现有成员的"编辑"按钮
   - 在头像区域上传图片
   - 填写其他信息并保存

### 用户体验

1. **查看成员列表**:
   - 主页显示所有成员及其头像
   - 点击成员卡片查看详情

2. **查看成员详情**:
   - 显示大尺寸头像
   - 登录用户可查看联系方式

## 📁 文件结构

```
TeamPages/
├── uploads/                 # 上传的头像文件
├── public/default-avatars/  # 默认头像占位符
├── server/
│   ├── routes/upload.js     # 头像上传API
│   ├── database/migrate.js # 数据库迁移脚本
│   └── scripts/
│       └── add-random-avatars.js # 随机头像分配脚本
└── client/src/views/Admin.vue # 管理界面（已更新）
```

## 🔧 故障排除

### 上传失败

1. **检查文件大小**：
   - 确保图片小于5MB

2. **检查文件类型**：
   - 只支持图片格式（JPG、PNG、GIF等）

3. **检查权限**：
   - 确保 `uploads/` 目录可写

### 显示问题

1. **刷新页面**：
   - 清除浏览器缓存

2. **检查网络**：
   - 确保能访问 `/api/upload/avatar/` 路径

3. **查看控制台**：
   - 检查JavaScript错误

## 🎉 完成效果

- 🖼️ **丰富视觉**: 每个成员都有个性化头像
- 📤 **便捷管理**: 直接拖拽上传，无需外部URL
- 🔄 **灵活切换**: 可以随时更换头像或使用URL
- 📱 **响应式**: 头像在各种设备上都能很好显示

---

🎨 **享受更生动的团队成员展示！**